import{d as D,b as R,r as T,e as s,f as g,y as S,w as l,h as a,n as w,t as m,Q as A,R as O,j as e,E as x,G as ee,a as te,i as N,g as P,k as h,S as ae,_ as le,a7 as oe,a8 as ne,M as re,X as se,Y as ie,Z as ue,V as Q,ac as de}from"./index-3efbb394.js";import{d as y}from"./util-8cf766eb.js";import{u as me}from"./useSelection-1dc1eb7e.js";import{u as pe}from"./useAuthButtons-6e5ad93a.js";import{u as ce}from"./useTable-6d3cf82e.js";import{o as fe,p as be}from"./task-dcbb5ca7.js";import{a as we}from"./trolley-b1fc672d.js";import{u as _e}from"./useHandleData-6dfe8d42.js";import"./serviceDict-19376974.js";import"./index-2ef92394.js";const ye=D({name:"qtyDrawer"}),ge=D({...ye,setup(H,{expose:E}){const B=R({OrderKey:[{trigger:"blur"}],BOStatus:[{required:!0,trigger:"change"}],Priority:[{required:!0,trigger:"blur"}]}),p=T(!1),o=T({isView:!1,title:""}),U=n=>{o.value=n,p.value=!0},c=T(),d=()=>{c.value.validate(async n=>{if(!!n)try{if(!o.value.apiUrl)return;await o.value.apiUrl(o.value.rowData),x.success({message:`${o.value.title}\u4EFB\u52A1\u6210\u529F\uFF01`}),o.value.getTableList&&o.value.getTableList(),p.value=!1}catch(i){}})};return E({acceptParams:U}),(n,i)=>{const v=s("el-input"),k=s("el-form-item"),F=s("el-form"),$=s("el-button"),z=s("el-drawer");return g(),S(z,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=f=>p.value=f),"destroy-on-close":!0,size:"500px",title:o.value.title+n.$t("set.Task")},{footer:l(()=>[a($,{onClick:i[2]||(i[2]=f=>p.value=!1)},{default:l(()=>[w(m(n.$t("set.Cancel")),1)]),_:1}),A(a($,{type:"primary",onClick:d},{default:l(()=>[w(m(n.$t("set.Confirm")),1)]),_:1},512),[[O,!o.value.isView]])]),default:l(()=>[a(F,{ref_key:"ruleFormRef",ref:c,rules:e(B),disabled:o.value.isView,model:o.value.rowData,"label-width":"100px"},{default:l(()=>[a(k,{label:n.$t("set.ContainerCode"),prop:"ContainerCode",clearable:""},{default:l(()=>[a(v,{modelValue:o.value.rowData.ContainerCode,"onUpdate:modelValue":i[0]||(i[0]=f=>o.value.rowData.ContainerCode=f),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(k,{label:n.$t("set.Qty"),prop:"Qty",clearable:""},{default:l(()=>[a(v,{modelValue:o.value.rowData.Qty,"onUpdate:modelValue":i[1]||(i[1]=f=>o.value.rowData.Qty=f),type:"number",oninput:"if(value.length>2)value=value.slice(0,2)"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","disabled","model"])]),_:1},8,["modelValue","title"])}}}),ve={class:"table-box"},Ce={class:"table-search"},he={style:{"margin-left":"24px"}},ke={class:"more-item"},$e={class:"search-operation"},Ve={style:{"margin-left":"0"}},Te={key:2},Se=D({name:"backStock"}),Pe=D({...Se,setup(H){const E=ee(),B=te(()=>E.language);N.global.locale=B.value;const{t:p}=N.global,o=R({}),{tableData:U,pageable:c,searchParam:d,searchShow:n,initSearchParam:i,getTableList:v,search:k,reset:F,handleSizeChange:$,handleCurrentChange:z}=ce(fe,o),{selectionChange:f,getRowKeys:Y}=me(),{BUTTONS:_}=pe();i.value={};const M=async t=>{await _e(we,{containerCode:t.ContainerCode,locationNo:t.ToLocation,taskKey:t.ExternalTaskKey,returnQty:t.Qty},p("set.BackStock")+`\u3010${t.ExternalTaskKey}\u3011`+p("set.Task")),v()},L=T(),q=(t,u={})=>{let V={title:t,rowData:{...u},isView:t==="\u67E5\u770B",apiUrl:t==="\u7F16\u8F91"?be:"",getTableList:v};L.value.acceptParams(V)};return(t,u)=>{const V=s("el-input"),K=s("el-form-item"),I=s("el-switch"),j=s("el-date-picker"),G=s("el-form"),C=s("el-button"),X=s("el-icon"),b=s("el-table-column"),Z=s("el-table"),J=s("el-pagination");return g(),P("div",ve,[h("div",Ce,[a(G,{ref:"formRef",model:e(d),inline:!0,"label-width":"100px"},{default:l(()=>[a(K,{label:t.$t("set.ContainerCode")},{default:l(()=>[a(V,{modelValue:e(d).ContainerCode,"onUpdate:modelValue":u[0]||(u[0]=r=>e(d).ContainerCode=r),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),a(K,{label:t.$t("set.ExternalTaskKey")},{default:l(()=>[a(V,{modelValue:e(d).ExternalTaskKey,"onUpdate:modelValue":u[1]||(u[1]=r=>e(d).ExternalTaskKey=r),clearable:""},null,8,["modelValue"]),h("span",he,m(t.$t("set.IsBack")),1),a(I,{modelValue:e(d).IsHistory,"onUpdate:modelValue":u[2]||(u[2]=r=>e(d).IsHistory=r),style:{"margin-left":"8px"},"inline-prompt":"","active-icon":e(oe),"inactive-icon":e(ne)},null,8,["modelValue","active-icon","inactive-icon"])]),_:1},8,["label"]),A(h("div",ke,[a(K,{label:t.$t("set.AddedTime")},{default:l(()=>[a(j,{modelValue:e(d).AddedTime,"onUpdate:modelValue":u[3]||(u[3]=r=>e(d).AddedTime=r),type:"datetimerange","start-placeholder":t.$t("set.StartTime"),"end-placeholder":t.$t("set.EndTime"),"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1},8,["label"])],512),[[O,e(n)]])]),_:1},8,["model"]),h("div",$e,[a(C,{type:"primary",icon:e(ae),onClick:e(k)},{default:l(()=>[w(m(t.$t("set.Search")),1)]),_:1},8,["icon","onClick"]),a(C,{icon:e(le),onClick:e(F)},{default:l(()=>[w(m(t.$t("set.Reset")),1)]),_:1},8,["icon","onClick"]),a(C,{type:"primary",link:"",class:"search-isOpen",onClick:u[4]||(u[4]=r=>n.value=!e(n))},{default:l(()=>[w(m(e(n)?t.$t("set.Close"):t.$t("set.Open"))+" ",1),a(X,{class:"el-icon--right"},{default:l(()=>[(g(),S(re(e(n)?e(se):e(ie))))]),_:1})]),_:1})])]),a(Z,{height:"575",data:e(U),border:!0,onSelectionChange:e(f),"row-key":e(Y),"row-style":{height:"30px"},"cell-style":{padding:"0px"},stripe:""},{default:l(()=>[a(b,{label:t.$t("set.SerialNumber"),width:"80"},{default:l(r=>[h("span",Ve,m((e(c).pageNum-1)*e(c).pageSize+r.$index+1),1)]),_:1},8,["label"]),a(b,{prop:"ContainerCode",label:t.$t("set.ContainerCode"),formatter:e(y),"show-overflow-tooltip":"",width:"150"},null,8,["label","formatter"]),a(b,{prop:"FromLocation",label:t.$t("set.FromLocation"),formatter:e(y),"show-overflow-tooltip":"",width:"200"},null,8,["label","formatter"]),a(b,{prop:"ToLocation",label:t.$t("set.ToLocation"),formatter:e(y),"show-overflow-tooltip":"",width:"200"},null,8,["label","formatter"]),a(b,{prop:"Qty",label:t.$t("set.Qty"),formatter:e(y),"show-overflow-tooltip":"",width:"100"},null,8,["label","formatter"]),a(b,{prop:"ExternalTaskKey",label:t.$t("set.ExternalTaskKey"),formatter:e(y),"show-overflow-tooltip":"",width:"200"},null,8,["label","formatter"]),a(b,{prop:"AddedTime",label:t.$t("set.AddedTime"),formatter:e(y),"show-overflow-tooltip":"",sortable:"","sort-orders":["descending","ascending"],width:"200"},null,8,["label","formatter"]),a(b,{label:t.$t("set.Operate"),fixed:"right",width:"300"},{default:l(r=>[e(_).delete&&r.row.Status!="Cancelled"?(g(),S(C,{key:0,type:"primary",link:"",icon:e(ue),onClick:W=>q(t.$t("set.Edit"),r.row)},{default:l(()=>[w(m(t.$t("set.Edit")),1)]),_:2},1032,["icon","onClick"])):Q("",!0),e(_).reset&&r.row.Status!="Cancelled"?(g(),S(C,{key:1,type:"primary",link:"",icon:e(de),onClick:W=>M(r.row)},{default:l(()=>[w(m(t.$t("set.BackStock")),1)]),_:2},1032,["icon","onClick"])):Q("",!0),!e(_).view&&!e(_).edit&&!e(_).reset&&!e(_).delete?(g(),P("span",Te,"--")):Q("",!0)]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange","row-key"]),a(J,{currentPage:e(c).pageNum,"page-size":e(c).pageSize,"page-sizes":[10,25,50,100,1e3],background:"",layout:"total, sizes, prev, pager, next, jumper",total:e(c).total,onSizeChange:e($),onCurrentChange:e(z)},null,8,["currentPage","page-size","total","onSizeChange","onCurrentChange"]),a(ge,{ref_key:"drawerRef",ref:L},null,512)])}}});export{Pe as default};
